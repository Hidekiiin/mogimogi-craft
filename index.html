<!DOCTYPE html>
<html>
<head>
  <title>ã‚‚ãã‚‚ãã‚¯ãƒ©ãƒ•ãƒˆ</title>
  <style>
    body {
      margin: 0;
      background-color: #87ceeb;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
    #fruit-count, #tool-info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.8);
      padding: 5px 10px;
      border-radius: 8px;
    }
    #tool-info {
      top: 40px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="fruit-count">ğŸ ãƒ•ãƒ«ãƒ¼ãƒ„: 0</div>
  <div id="tool-info">ğŸ”¨ ãƒ„ãƒ¼ãƒ«: æ‰‹</div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // ã‚²ãƒ¼ãƒ å¤‰æ•°
    let fruits = [];
    let inventory = { fruit: 0, wood: 0, stone: 0 };
    let selectedTool = 'hand';

    // æœ¨ã¨çŸ³ã®ä½ç½®
    let trees = [{ x: 200, y: 300 }, { x: 600, y: 400 }];
    let rocks = [{ x: 400, y: 500 }];

    // ãƒ•ãƒ«ãƒ¼ãƒ„ã‚¯ãƒ©ã‚¹
    class Fruit {
      constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.type = type; // ãƒ•ãƒ«ãƒ¼ãƒ„ã®ç¨®é¡
        this.isFalling = false;
        this.vibration = 0; // ãµã‚‹ãµã‚‹åŠ¹æœ
      }

      draw() {
        if (this.type === 'peach') {
          this.drawPeach();
        } else if (this.type === 'lemon') {
          this.drawLemon();
        } else if (this.type === 'grape') {
          this.drawGrape();
        } else if (this.type === 'apple') {
          this.drawApple();
        }
      }

      // ğŸ‘ ãƒ”ãƒ¼ãƒã‚’æç”»
      drawPeach() {
        ctx.beginPath();
        ctx.moveTo(this.x, this.y + this.vibration);
        ctx.bezierCurveTo(this.x - 20, this.y - 30 + this.vibration, this.x + 20, this.y - 30 + this.vibration, this.x, this.y);
        ctx.lineTo(this.x, this.y + 25);
        ctx.arc(this.x, this.y + 10, 15, Math.PI, 0, false);
        ctx.fillStyle = '#ff9999';
        ctx.fill();
        ctx.closePath();
      }

      // ğŸ‹ ãƒ¬ãƒ¢ãƒ³ã‚’æç”»
      drawLemon() {
        ctx.beginPath();
        ctx.ellipse(this.x, this.y + this.vibration, 20, 30, Math.PI / 4, 0, 2 * Math.PI);
        ctx.fillStyle = '#ffeb3b';
        ctx.fill();
        ctx.closePath();
      }

      // ğŸ‡ ã‚°ãƒ¬ãƒ¼ãƒ—ã‚’æç”»
      drawGrape() {
        const colors = ['#8a2be2', '#6a0dad', '#4b0082'];
        for (let i = 0; i < 6; i++) {
          let offsetX = (i % 2) * 15;
          let offsetY = Math.floor(i / 2) * 15;
          ctx.beginPath();
          ctx.arc(this.x + offsetX, this.y + offsetY + this.vibration, 8, 0, Math.PI * 2);
          ctx.fillStyle = colors[i % 3];
          ctx.fill();
          ctx.closePath();
        }
      }

      // ğŸ ãƒªãƒ³ã‚´ã‚’æç”»
      drawApple() {
        ctx.beginPath();
        ctx.arc(this.x, this.y + this.vibration, 20, 0, Math.PI * 2);
        ctx.fillStyle = '#ff4d4d';
        ctx.fill();
        ctx.closePath();
        ctx.beginPath();
        ctx.arc(this.x, this.y - 15 + this.vibration, 5, 0, Math.PI * 2);
        ctx.fillStyle = '#4d2600';
        ctx.fill(); // èŒ
        ctx.closePath();
      }

      // ãµã‚‹ãµã‚‹åŠ¹æœ & è½ä¸‹
      fall() {
        if (this.isFalling) {
          this.y += 5;
          if (this.y > canvas.height - 30) {
            this.isFalling = false;
          }
        } else {
          this.vibration = Math.sin(Date.now() * 0.01) * 3;
        }
      }
    }

    // æœ¨ã‚’æç”»
    function drawTrees() {
      ctx.fillStyle = 'green';
      trees.forEach(tree => {
        ctx.fillRect(tree.x - 25, tree.y - 50, 50, 100);
      });
    }

    // çŸ³ã‚’æç”»
    function drawRocks() {
      ctx.fillStyle = 'gray';
      rocks.forEach(rock => {
        ctx.beginPath();
        ctx.arc(rock.x, rock.y, 30, 0, Math.PI * 2);
        ctx.fill();
        ctx.closePath();
      });
    }

    // ã‚¢ã‚¤ãƒ†ãƒ å–å¾—å‡¦ç†
    function collectFruit(fruit) {
      inventory.fruit++;
      document.getElementById('fruit-count').innerText = `ğŸ ãƒ•ãƒ«ãƒ¼ãƒ„: ${inventory.fruit}`;
    }

    // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    canvas.addEventListener('mousedown', (e) => {
      const mouseX = e.clientX;
      const mouseY = e.clientY;

      // ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’ã‚¿ãƒƒãƒ—ã§å–å¾—
      fruits.forEach((fruit, index) => {
        const dist = Math.hypot(mouseX - fruit.x, mouseY - fruit.y);
        if (dist < 25) {
          fruits.splice(index, 1);
          collectFruit(fruit);
        }
      });

      // æœ¨ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãƒ•ãƒ«ãƒ¼ãƒ„ç”Ÿæˆ
      trees.forEach(tree => {
        if (
          mouseX > tree.x - 25 &&
          mouseX < tree.x + 25 &&
          mouseY > tree.y - 50 &&
          mouseY < tree.y + 50
        ) {
          const fruitTypes = ['peach', 'lemon', 'grape', 'apple'];
          const randomType = fruitTypes[Math.floor(Math.random() * fruitTypes.length)];
          const newFruit = new Fruit(tree.x, tree.y + 50, randomType);
          newFruit.isFalling = true;
          fruits.push(newFruit);
        }
      });

      // æœ¨æã€çŸ³ã®åé›†
      if (selectedTool === 'axe') {
        trees.forEach((tree, index) => {
          if (
            mouseX > tree.x - 25 &&
            mouseX < tree.x + 25 &&
            mouseY > tree.y - 50 &&
            mouseY < tree.y + 50
          ) {
            inventory.wood++;
            trees.splice(index, 1);
            alert('ğŸŒ³ æœ¨æã‚’å–å¾—ã—ã¾ã—ãŸï¼');
          }
        });
      } else if (selectedTool === 'hammer') {
        rocks.forEach((rock, index) => {
          const dist = Math.hypot(mouseX - rock.x, mouseY - rock.y);
          if (dist < 30) {
            inventory.stone++;
            rocks.splice(index, 1);
            alert('ğŸª¨ çŸ³ã‚’å–å¾—ã—ã¾ã—ãŸï¼');
          }
        });
      }
    });

    // ãƒ„ãƒ¼ãƒ«å¤‰æ›´
    document.addEventListener('keydown', (e) => {
      if (e.key === '1') {
        selectedTool = 'hand';
        document.getElementById('tool-info').innerText = 'ğŸ”¨ ãƒ„ãƒ¼ãƒ«: æ‰‹';
      } else if (e.key === '2') {
        selectedTool = 'axe';
        document.getElementById('tool-info').innerText = 'ğŸª“ ãƒ„ãƒ¼ãƒ«: æ–§';
      } else if (e.key === '3') {
        selectedTool = 'hammer';
        document.getElementById('tool-info').innerText = 'ğŸ”¨ ãƒ„ãƒ¼ãƒ«: ãƒãƒ³ãƒãƒ¼';
      }
    });

    // ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawTrees();
      drawRocks();

      // ãƒ•ãƒ«ãƒ¼ãƒ„æç”»ã¨è½ä¸‹å‡¦ç†
      fruits.forEach(fruit => {
        fruit.draw();
        fruit.fall();
      });

      requestAnimationFrame(gameLoop);
    }

    // ã‚²ãƒ¼ãƒ é–‹å§‹
    gameLoop();
  </script>
</body>
</html>
