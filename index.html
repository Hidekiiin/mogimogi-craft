<!DOCTYPE html>
<html>
<head>
  <title>„ÇÇ„Åé„ÇÇ„Åé„ÇØ„É©„Éï„Éà</title>
  <style>
    body {
      margin: 0;
      background-color: #87ceeb;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
    #fruit-count, #tool-info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.8);
      padding: 5px 10px;
      border-radius: 8px;
    }
    #tool-info {
      top: 40px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="fruit-count">üçé „Éï„É´„Éº„ÉÑ: 0</div>
  <div id="tool-info">üî® „ÉÑ„Éº„É´: Êâã</div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // „Ç≤„Éº„É†Â§âÊï∞
    let fruits = [];
    let inventory = { fruit: 0, wood: 0, stone: 0 };
    let selectedTool = 'hand';

    // Êú®„ÅÆÁîüÊàêÔºà„É©„É≥„ÉÄ„É†ÈÖçÁΩÆ 5„Äú8Êú¨Ôºâ
    let trees = Array.from({ length: Math.floor(Math.random() * 4) + 5 }, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height * 0.8 + 100
    }));

    let rocks = [{ x: 400, y: 500 }];

    // „Çπ„ÉØ„Ç§„ÉóÁî®Â§âÊï∞
    let startX = 0;
    let startY = 0;
    let offsetX = 0;
    let offsetY = 0;

    // „Éï„É´„Éº„ÉÑ„ÇØ„É©„Çπ
    class Fruit {
      constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.type = type; // „Éï„É´„Éº„ÉÑ„ÅÆÁ®ÆÈ°û
        this.isFalling = false;
        this.vibration = 0; // „Åµ„Çã„Åµ„ÇãÂäπÊûú
      }

      draw() {
        if (this.type === 'peach') {
          this.drawPeach();
        } else if (this.type === 'lemon') {
          this.drawLemon();
        } else if (this.type === 'grape') {
          this.drawGrape();
        } else if (this.type === 'apple') {
          this.drawApple();
        }
      }

      // üçë „Éî„Éº„ÉÅ
      drawPeach() {
        ctx.beginPath();
        ctx.moveTo(this.x, this.y + this.vibration);
        ctx.bezierCurveTo(this.x - 20, this.y - 30 + this.vibration, this.x + 20, this.y - 30 + this.vibration, this.x, this.y);
        ctx.lineTo(this.x, this.y + 25);
        ctx.arc(this.x, this.y + 10, 15, Math.PI, 0, false);
        ctx.fillStyle = '#ff9999';
        ctx.fill();
        ctx.closePath();
      }

      // üçã „É¨„É¢„É≥
      drawLemon() {
        ctx.beginPath();
        ctx.ellipse(this.x, this.y + this.vibration, 20, 30, Math.PI / 4, 0, 2 * Math.PI);
        ctx.fillStyle = '#ffeb3b';
        ctx.fill();
        ctx.closePath();
      }

      // üçá „Ç∞„É¨„Éº„Éó
      drawGrape() {
        const colors = ['#8a2be2', '#6a0dad', '#4b0082'];
        for (let i = 0; i < 6; i++) {
          let offsetX = (i % 2) * 15;
          let offsetY = Math.floor(i / 2) * 15;
          ctx.beginPath();
          ctx.arc(this.x + offsetX, this.y + offsetY + this.vibration, 8, 0, Math.PI * 2);
          ctx.fillStyle = colors[i % 3];
          ctx.fill();
          ctx.closePath();
        }
      }

      // üçé „É™„É≥„Ç¥
      drawApple() {
        ctx.beginPath();
        ctx.arc(this.x, this.y + this.vibration, 20, 0, Math.PI * 2);
        ctx.fillStyle = '#ff4d4d';
        ctx.fill();
        ctx.closePath();
        ctx.beginPath();
        ctx.arc(this.x, this.y - 15 + this.vibration, 5, 0, Math.PI * 2);
        ctx.fillStyle = '#4d2600';
        ctx.fill();
        ctx.closePath();
      }

      // „Åµ„Çã„Åµ„Çã & ËêΩ‰∏ã
      fall() {
        if (this.isFalling) {
          this.y += 5;
          if (this.y > canvas.height - 30) {
            this.isFalling = false;
          }
        } else {
          this.vibration = Math.sin(Date.now() * 0.05) * 3;
        }
      }
    }

    // Êú®„ÇíÊèèÁîª
    function drawTrees() {
      ctx.fillStyle = 'green';
      trees.forEach(tree => {
        ctx.fillRect(tree.x - 25 + offsetX, tree.y - 50 + offsetY, 50, 100);
      });
    }

    // Áü≥„ÇíÊèèÁîª
    function drawRocks() {
      ctx.fillStyle = 'gray';
      rocks.forEach(rock => {
        ctx.beginPath();
        ctx.arc(rock.x + offsetX, rock.y + offsetY, 30, 0, Math.PI * 2);
        ctx.fill();
        ctx.closePath();
      });
    }

    // „Ç¢„Ç§„ÉÜ„É†ÂèñÂæóÂá¶ÁêÜ
    function collectFruit(fruit) {
      inventory.fruit++;
      document.getElementById('fruit-count').innerText = `üçé „Éï„É´„Éº„ÉÑ: ${inventory.fruit}`;
    }

    // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
    canvas.addEventListener('mousedown', (e) => {
      const mouseX = e.clientX - offsetX;
      const mouseY = e.clientY - offsetY;

      // „Éï„É´„Éº„ÉÑ„Çí„Çø„ÉÉ„Éó„ÅßÂèñÂæó
      fruits.forEach((fruit, index) => {
        const dist = Math.hypot(mouseX - fruit.x, mouseY - fruit.y);
        if (dist < 25) {
          fruits.splice(index, 1);
          collectFruit(fruit);
        }
      });

      // Êú®„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Éï„É´„Éº„ÉÑÁîüÊàê
      trees.forEach(tree => {
        if (
          mouseX > tree.x - 25 &&
          mouseX < tree.x + 25 &&
          mouseY > tree.y - 50 &&
          mouseY < tree.y + 50
        ) {
          const fruitTypes = ['peach', 'lemon', 'grape', 'apple'];
          const randomType = fruitTypes[Math.floor(Math.random() * fruitTypes.length)];
          const newFruit = new Fruit(tree.x, tree.y + 50, randomType);
          newFruit.isFalling = true;
          fruits.push(newFruit);
        }
      });

      // Êú®Êùê„ÄÅÁü≥„ÅÆÂèéÈõÜ
      if (selectedTool === 'axe') {
        trees.forEach((tree, index) => {
          if (
            mouseX > tree.x - 25 &&
            mouseX < tree.x + 25 &&
            mouseY > tree.y - 50 &&
            mouseY < tree.y + 50
          ) {
            inventory.wood++;
            trees.splice(index, 1);
            alert('üå≥ Êú®Êùê„ÇíÂèñÂæó„Åó„Åæ„Åó„ÅüÔºÅ');
          }
        });
      } else if (selectedTool === 'hammer') {
        rocks.forEach((rock, index) => {
          const dist = Math.hypot(mouseX - rock.x, mouseY - rock.y);
          if (dist < 30) {
            inventory.stone++;
            rocks.splice(index, 1);
            alert('ü™® Áü≥„ÇíÂèñÂæó„Åó„Åæ„Åó„ÅüÔºÅ');
          }
        });
      }
    });

    // „Çπ„ÉØ„Ç§„ÉóÈñãÂßã
    canvas.addEventListener('touchstart', (e) => {
      if (e.touches.length === 2) {
        startX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
        startY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
      }
    });

    // „Çπ„ÉØ„Ç§„Éó„ÅßÁßªÂãï
    canvas.addEventListener('touchmove', (e) => {
      if (e.touches.length === 2) {
        const newX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
        const newY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
        offsetX += newX - startX;
        offsetY += newY - startY;
        startX = newX;
        startY = newY;
      }
    });

    // „ÉÑ„Éº„É´Â§âÊõ¥
    document.addEventListener('keydown', (e) => {
      if (e.key === '1') {
        selectedTool = 'hand';
        document.getElementById('tool-info').innerText = 'üî® „ÉÑ„Éº„É´: Êâã';
      } else if (e.key === '2') {
        selectedTool = 'axe';
        document.getElementById('tool-info').innerText = 'ü™ì „ÉÑ„Éº„É´: Êñß';
      } else if (e.key === '3') {
        selectedTool = 'hammer';
        document.getElementById('tool-info').innerText = 'üî® „ÉÑ„Éº„É´: „Éè„É≥„Éû„Éº';
      }
    });

    // „É°„Ç§„É≥„É´„Éº„Éó
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawTrees();
      drawRocks();

      // „Éï„É´„Éº„ÉÑÊèèÁîª„Å®ËêΩ‰∏ãÂá¶ÁêÜ
      fruits.forEach(fruit => {
        fruit.draw();
        fruit.fall();
      });

      requestAnimationFrame(gameLoop);
    }

    // „Ç≤„Éº„É†ÈñãÂßã
    gameLoop();
  </script>
</body>
</html>
